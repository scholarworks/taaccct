<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

<script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<style type="text/css">
.industries {
	margin: 20px;
}
</style>
<script>
$(document).ready(function() {

	var industryAPI = "http://www.skillscommons.org/portal/api/industries.php";
	$.getJSON( industryAPI )
		.done(function(data) {

			var $topAccordion = $('<div class="panel-group" id="accordion1" />');
			var $topAccordionGroup = $('<div class="panel panel-default" />');
			
			$.each(data.children, function (i, item) {
				
				var $topAccordionHeading = $('<div class="panel-heading" />');
				var $topAccordionTitle = $('<h4 class="panel-title" />');
				var $topAccordionToggle = $('<a data-toggle="collapse" data-parent="#accordion1" href="#' + item.name + '"/>');
				$topAccordionToggle.append(item.name);
				$topAccordionTitle.append($topAccordionToggle);
				$topAccordionHeading.append($topAccordionTitle);

				var $topAccordingInner = $('<div id="'+ item.name +'" class="panel-collapse collapse in" />');
				var $topAccordionInnerContent = $('<div class="panel-body" />');
			

				
				var root_size = 0;
				
				var $level2Accordion = $('<div class="panel-group" id="accordion2" />');
				var $level2AccordionGroup = $('<div class="panel panel-default" />');

				$.each(item.children, function (c, child) {

					var $level2AccordionHeading = $('<div class="panel-heading" />');
					var $level2AccordionTitle = $('<h4 class="panel-title" />');
					var $level2AccordionToggle = $('<a data-toggle="collapse" data-parent="#accordion2" href="#' + item.name + "_" + c + '" />');

					$level2AccordionToggle.append(child.name);
					$level2AccordionTitle.append($level2AccordionToggle);
					$level2AccordionHeading.append($level2AccordionTitle);

					var $level2AccordingInner = $('<div id="collapseTwo" class="panel-collapse collapse in" />');
					var $level2AccordionInnerContent = $('<div class="panel-body" />');
					var $level2Table = $('<table class="table" />');
					var $level2TableBody = $('<tbody />');
					
					var parent_size = 0;
					
					if(child.size) {
						root_size += child.size;
					} else {
						
						$.each(child.children, function (cc, child_child) {
							$level2Content = '<tr><td><a>' + child_child.name + '</a></td></tr>';
							$level2TableBody.append($level2Content);
							// console.log(child_child);
							if(child_child.size) {
								root_size += child_child.size;
								parent_size += child_child.size;
							}
						});
						$level2Table.append($level2TableBody);
						$level2AccordionInnerContent.append($level2Table);
						$level2AccordingInner.append($level2AccordionInnerContent);
					}


					
					$level2AccordionGroup.append($level2AccordionHeading);
					$level2AccordionGroup.append($level2AccordingInner);
					$level2Accordion.append($level2AccordionGroup);
					$topAccordionInnerContent.append($level2Accordion);
					// $parent_ul.append($parent_li);
				});
				
				$topAccordingInner.append($topAccordionInnerContent);
				
//				$top_parent_li.append($parent_ul);

				$topAccordionGroup.append($topAccordionHeading);
				$topAccordionGroup.append($topAccordingInner);
				$topAccordion.append($topAccordionGroup);

			});


			$('#categories').html($topAccordion);

		});
	// alert("end function");
});
</script>

</head>
<body>

<div id="categories" class="industries"></div>
</body>
</html>